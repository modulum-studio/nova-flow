---
import { type Language } from '../utils/i18n';

const currentLang = (Astro.currentLocale as Language) || 'en';
const base = import.meta.env.BASE_URL || '/';

// Generate URLs for language switching with proper base path handling
const getLanguageUrl = (lang: Language) => {
  if (lang === 'en') {
    // For English, return base path (root)
    return base === '/' ? '/' : base;
  } else {
    // For Spanish, add /es to base path
    return base === '/' ? '/es/' : `${base}es/`;
  }
};
---

<div class="relative language-switcher">
  <button 
    id="language-toggle"
    class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors flex items-center space-x-1"
    aria-label="Switch language"
  >
    <svg class="w-4 h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
    </svg>
    <span class="text-sm font-medium text-gray-600 dark:text-gray-300">{currentLang.toUpperCase()}</span>
    <svg class="w-3 h-3 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>
  
  <div 
    id="language-dropdown" 
    class="absolute right-0 mt-2 w-32 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 hidden z-50"
  >
    <a 
      href={getLanguageUrl('en')}
      class={`block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-lg transition-colors ${currentLang === 'en' ? 'bg-primary-50 dark:bg-primary-900 text-primary-600 dark:text-primary-400' : 'text-gray-700 dark:text-gray-300'}`}
    >
      English
    </a>
    <a 
      href={getLanguageUrl('es')}
      class={`block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-lg transition-colors ${currentLang === 'es' ? 'bg-primary-50 dark:bg-primary-900 text-primary-600 dark:text-primary-400' : 'text-gray-700 dark:text-gray-300'}`}
    >
      Espa√±ol
    </a>
  </div>
</div>

<script>
  // Simple dropdown toggle functionality
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('language-toggle');
    const dropdown = document.getElementById('language-dropdown');
    
    if (!toggle || !dropdown) return;

    // Toggle dropdown
    toggle.addEventListener('click', (e) => {
      e.stopPropagation();
      dropdown.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', () => {
      dropdown.classList.add('hidden');
    });
  });
</script>
